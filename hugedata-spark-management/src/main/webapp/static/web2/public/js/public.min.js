$(function(){
	MU.init();

	$("#userChoice li.item").on({//头部用户信息下拉菜单
		mouseenter: function(){
			var w = $(this).outerWidth();
			w = w-50;
			$(this).find('div.user-info').css({'width':w,'left':-1}).show();
			$("#userChoice li.item:last").find('div.user-info').css({'right':-5,"left":"auto"})
		},
		mouseleave: function(){
			$(this).find('div.user-info').hide();
		}
	});

	$("#minH").css('min-height',$(window).height()-440);//最小高度
	$(".column_menu").css('min-height',$("#minH").height());//左侧菜单最小高度
	$(".slideImg .pageImg").css("height",$(window).height()-130); //  首页背景图片高度全屏自适应
	$(".index-block").css("margin-top",($(window).height()-$(".index-block").height()-320)/2); //  首页主体内容居中

});
var MU = {
	maxZIndex: 1000,
	init: function(){

        $("body").on('click','label.checkbox',function(){   //单复选按钮
            if($(this).hasClass('disabled')){return false;}
            if($(this).hasClass('radio')){
                $(this).addClass('checked').siblings().removeClass('checked');
                var $name = $(this).attr('name');
                $(".radio[name="+$name+"]").removeClass('checked');
                $(this).addClass('checked');
            }else{
                $(this)[$(this).hasClass('checked')?'removeClass':'addClass']('checked');
                $(this).next().find('input').attr('disabled',!$(this).hasClass('checked'));
            }
        });

        $(".js-all-selected").on('click',function(){	//表格展示全选
            if($(this).hasClass('checked')){
                $(this).removeClass('checked');
                $(this).closest('table.column_tab_table').find('label.checkbox').removeClass('checked');
            }else{
                $(this).addClass('checked');
                $(this).closest('table.column_tab_table').find('label.checkbox').addClass('checked');
            }
        });

		$("body").on('click','label.radio-pass',function(){   // 行政审批-在线办理-办件详情-点击通过按钮 显示接收部门和接收人
			if($(this).hasClass('checked')) {
				$("h3.detail-title.hide").show();
				$(".filter-box.hide").show();
				$(".column_menu").css('min-height',$("#minH").height());//左侧菜单最小高度
			}
		});

		$("body").on('click','label.pass-review-radio',function(){   // 行政审批-在线办理-办件详情（复审）-点击“通过”按钮 显示接收部门和接收人
			if($(this).hasClass('checked')) {
				$(".next-btn").show();
				$("h3.detail-title.hide").show();
				$(".filter-box.hide").show();
				$(".column_menu").css('min-height',$("#minH").height());//左侧菜单最小高度
			}
		});

        $("body").on('click','label.pass-review-radio2',function(){   // 行政审批-在线办理-办件详情（复审）-点击“不通过”按钮 隐藏“下一步”按钮
            if($(this).hasClass('checked')) {
                $(".next-btn").show();
            }
        });

		$("body").on('click','label.fail-review-radio',function(){   // 行政审批-在线办理-办件详情（复审）-点击“不通过”按钮 隐藏“下一步”按钮
			if($(this).hasClass('checked')) {
				$(".next-btn").hide();
			}
		});

		$("body").on('click','label.pass-check-radio',function(){   // 行政审批-在线办理-办件详情（确认办结）-点击“已办结” 显示上传功能
			if($(this).hasClass('checked')) {
				$(".upload-file").show();
			}
		});

		$("body").on('click','label.fail-check-radio',function(){   // 行政审批-在线办理-办件详情（确认办结）-点击“审核不通过” 隐藏上传功能
			if($(this).hasClass('checked')) {
				$(".upload-file").hide();
			}
		});


        /*批量删除*/
        $(".del-group").on('click',function(){
            if($("table.column_tab_table").find('label').hasClass('checked')) {
                MU.conFirm('删除','您确定要删除吗？',delItem2);
            }else{
                MU.msgTips('warn',"请选择删除对象！");
            }
        });
        function delItem2(){
            $("table.column_tab_table").find('label.checked').each(function() {
                $(this).closest('tr').remove();
            });
        }

		$(".top-tips a.close").click(function(){  //顶部建议使用IE8以上浏览器（不含IE8）浏览网站 提示信息
			$(this).parent().hide();
		});

        $(".select").each(function(){  // 下拉列表
            $(this).children('select').selectList();
        });
	$(".leftsidebar a.drop").click(function(){  //  左侧菜单 二级菜单展开收缩
            if($(this).hasClass("down")){
                $(this).parent().removeClass('active');
                $(this).next().hide();
                $(this).removeClass('down');
            }else{
                //$(".leftsidebar li.nav").removeClass('active');
                //$(".leftsidebar dl").hide();
                //$(".leftsidebar .drop").removeClass('down');
                $(this).parent().addClass('active');
                $(this).next().show();
                $(this).addClass('down');
                return;
            }
        });
    },
	msgTips: function(status,txt,timeout){
		this.removeTips();
		var flag = status.match('loading')=='loading';
		var html = '<div class="msgbox_layer_wrap" id="msgTips"><span class="msgbox_layer"><span class="icon_clear"></span><span class="icon '+status+'"></span>'+txt+'<span class="icon_end"></span></span></div>';
		$('body').append(html);
		if (flag) {
			$("#msgTips .loading").removeClass('icon');
			//$("body").append('<div id="loadingBg"></div>');
			//$("#loadingBg").css({
		    	//"height": $(document).height()
		    //});
		}else{
			$("#msgTips .icon_clear").remove();
			setTimeout(this.removeTips,timeout||1200);
		};
	},
	removeTips: function(){
		$("#msgTips,#loadingBg").remove();
	},
	conFirm: function(title,msg,ConfirmFun){
		var html='<div class="dialog">'+msg+'</div><div class="btnbox"><a id="ConfirmFun" href="javascript:;" class="save_btn btn"><em>确&nbsp;定</em></a><a href="javascript:void(0)" class="clear_btn btn btn-grey" onclick="MU.close(this)"><em>取&nbsp;消</em></a></div>';
		this.alert(html,400,title);
		var that = this;
		if(ConfirmFun){
			$("#ConfirmFun").on('click',function(){
				ConfirmFun();
				that.close();
			})
		}
	},
	getCookie: function(name){//取cookie
        if(navigator.cookieEnabled){
            var arr = document.cookie.match(new RegExp("(^| )" + name + "=([^;]*)(;|$)"));
            if(arr != null) return decodeURIComponent(arr[2]);
        }
    },
    setCookie: function(name, value, day){//写cookie
        var exp  = new Date();
        exp.setTime(exp.getTime() + day * 24 * 60 * 60 * 1000);
        if(navigator.cookieEnabled){
            document.cookie = name + "=" + decodeURIComponent(value) + ";expires=" + exp.toGMTString();
        }
    },
    request: function(str){//获取URL参数
		var href = window.location.href;
		var p = str + '=';
		var array = href.split(p);
		if( array.length>1 ){
			var b = array[1].split('&').length;
			return b>1 ? array[1].split('&')[0] : array[1];
		}else{
			return undefined;
		}
	},
	isPhone: function(str){//验证手机
		var reg = /^0?(13[0-9]|15[012356789]|18[02356789]|14[57])[0-9]{8}$/
		return reg.test(str);
	},
	isEmail: function(str){//验证E-mail
		var apos = str.indexOf("@");
		var dotpos = str.lastIndexOf(".");
		return !(apos<1||dotpos-apos<2);
	},
	delay: function(fn,timeout){//延时（暂停）函数
		var dfd = $.Deferred();
		setTimeout(function() {
			dfd.resolve(fn());
		}, timeout || 0);
		return dfd.promise();
	},
	alert: function(msg,w,title,ConfirmFun,isClose,confirmBtnContent){
		var _this = this;
		var len = $("div[name=wh_alert]").length + 1;
		var html = '<div class="alert" style="width:'+w+'px" id="wh_alert_'+len+'" name="wh_alert">';
		if(title != ''){
			html = html + '<div class="title"><a href="javascript:;" onclick="MU.close(this)"></a>'+title+'</div>'+msg;
		}else{
			html = html + msg;
		}
		if(ConfirmFun){
			if(confirmBtnContent == undefined || confirmBtnContent =="")
			{
				html = html + '<div class="btn"><a href="javascript:;" class="save_btn" id="ConfirmFun"><em>确&nbsp;定</em></a><a href="javascript:void(0)" class="clear_btn" onclick="MU.close(this)"><em>取&nbsp;消</em></a></div></div>';
			}
			else
			{
				html = html + '<div class="btn"><a href="javascript:;" class="save_btn" id="ConfirmFun"><em>'+confirmBtnContent+'</em></a><a href="javascript:void(0)" class="clear_btn" onclick="MU.close(this)"><em>取&nbsp;消</em></a></div></div>';
			}
			$("body").prepend(html);
			$('#wh_alert_'+len).find('.save_btn').on('click',function(){
				ConfirmFun();
				if(isClose==undefined||isClose==""){
					_this.close();
				}
			})
		}else{
			html = html + '</div>';
			$("body").prepend(html);	
		}
 		this.mask();
		this.center($('#wh_alert_'+len));
		if(title != ''){this.drag('wh_alert_'+len);}
	},
	show: function(obj){
		var _this = this;
		$(window).scroll(function(){_this.scenter(obj);});
		$(window).resize(function(){_this.scenter(obj);});
	},
	scenter: function(obj){
		var windowWidth = document.documentElement.clientWidth;   
		var windowHeight = document.documentElement.clientHeight;   
		var popupHeight = $(obj).height();   
		var popupWidth = $(obj).width();    
		$(obj).css({   
			"top": (windowHeight-popupHeight)/2+$(document).scrollTop(),   
			"left": (windowWidth-popupWidth)/2   
		});  
	},
	center: function(obj,flag){
		var _this = this;
		var windowWidth = document.documentElement.clientWidth;
		var windowHeight = document.documentElement.clientHeight;   
		var popupHeight = $(obj).height();   
		var popupWidth = $(obj).width();
		//var top = (windowHeight-popupHeight)/2+$(document).scrollTop() > 0 ? (windowHeight-popupHeight)/2+$(document).scrollTop() : 46;
		var top = ($(window).height() - popupHeight) / 2;
		var index = parseInt( new Date().getTime()/1000 );
		$(obj).css({   
			"opacity": 0,
			"top": top-40,   
			"left": (windowWidth-popupWidth)/2,
			"z-index": ++MU.maxZIndex
		}); 
		$(obj).animate({"top":'+='+'40px',"opacity":"1"},400,function(){});
	},
	center2: function(obj,flag){
		var _this = this;
		var windowWidth = document.documentElement.clientWidth;
		var windowHeight = document.documentElement.clientHeight;   
		var popupHeight = $(obj).height();   
		var popupWidth = $(obj).width();
		//var top = (windowHeight-popupHeight)/2+$(document).scrollTop() > 0 ? (windowHeight-popupHeight)/2+$(document).scrollTop() : 46;
		//var top = ($(window).height() - popupHeight) / 2;
		var index = parseInt( new Date().getTime()/1000 );
		$(obj).css({   
			"opacity": 0,
			"top": 80,   
			"left": (windowWidth-popupWidth)/2,
			"z-index": ++MU.maxZIndex
		}); 
		$(obj).animate({"top":'+='+'40px',"opacity":"1"},400,function(){});
	},
	close: function(obj){
		var obj = obj || $(".alert:first").find("div.title").find('a');
		$(obj).parents("div[name=wh_alert]").animate({"top":'-='+'60px',"opacity":"0"},400,function(){
			$(obj).parents("div[name=wh_alert]").remove();
			if ($("div.alert:visible").length <= 0) {
				$("#filter").animate({"opacity":"0"},400,function(){$("#filter").remove();});
			}
		})
	},
	hide: function(obj){
		var obj = obj || $(".alert:first").find("div.title").find('a');
		$(obj).parents("div[name=wh_alert]").animate({"top":'-='+'60px',"opacity":"0"},400,function(){
			$(obj).parents("div[name=wh_alert]").hide();
			$("#filter").animate({"opacity":"0"},400,function(){
				$("#filter").remove();
			});
		})
	},
	loading: function(msg){
		$("body").prepend('<div id="msg_loading" class="msgbox"><em></em><span class="loading"></span><span class="msg_right"></span></div>');
		$("#msg_loading .loading").text(msg);
		this.center($("#msg_loading"));
		this.mask();
	},
	removeLoad: function(){
		$("#msg_loading").remove();
		this.delMask();
	},
	mask: function(){
		if($("#filter").length<=0){
			var mybg="<div id='filter'></div>";
			var h = $(document).height() > document.documentElement.clientHeight ? $(document).height() : document.documentElement.clientHeight;
			$("body").append(mybg);
			$("div#filter").height(h);
			$("#filter").animate({"opacity":"0.2"},400);
		}
	},
	delMask: function(){
		$("#filter").remove();
	},
	drag: function(dragObj){
 		var drag = typeof dragObj === 'string' ? document.getElementById(dragObj) : dragObj;
		var dTitle = drag.getElementsByTagName('div')[0];
		var disX = disY = 0;
		var isDrag = false;
		//drag.style.position = 'absolute';
		dTitle.style.cursor = 'move';
		dTitle.onmousedown = function(evt){
			drag.style.zIndex = parseInt( new Date().getTime()/1000 );
			evt = evt || window.event;
			isDrag = true;

			disX = evt.clientX - drag.offsetLeft;
			disY = evt.clientY - drag.offsetTop;

			this.setCapture && this.setCapture();

			return false;
		}

		dTitle.onmousemove = function(evt){
			evt = evt || window.event;
			if(!isDrag) return false;

			drag.style.margin = 0;
			drag.style.left = evt.clientX - disX + 'px';
			drag.style.top = evt.clientY - disY + 'px';

			return false;
		}

		dTitle.onmouseup = dTitle.onblur = dTitle.onlosecapture = function(){
			isDrag = false;
			dTitle.releaseCapture && dTitle.releaseCapture();
		}
	},
	between: function(m,b){
		return Math.round(Math.random() * (b-m)) + m;
	}
};